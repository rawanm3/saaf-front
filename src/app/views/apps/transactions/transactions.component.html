<app-page-title [title]="'TRANSACTIONS.TITLE' | translate" [subTitle]="'TRANSACTIONS.SUBTITLE' | translate" />

<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h4 class="mt-2">{{ 'TRANSACTIONS.LIST_TITLE' | translate }}</h4>
  </div>

  <div class="table-responsive px-2">
    <table class="table align-middle text-nowrap table-hover table-centered mb-0">
      <thead class="bg-light-subtle">
        <tr>
          <th>{{ 'TRANSACTIONS.USER_NAME' | translate }}</th>
          <th>{{ 'TRANSACTIONS.TYPE' | translate }}</th>
          <th>{{ 'TRANSACTIONS.AMOUNT' | translate }}</th>
          <th>{{ 'TRANSACTIONS.STATUS' | translate }}</th>
          <th>{{ 'TRANSACTIONS.CREATED_AT' | translate }}</th>
          <th>{{ 'TRANSACTIONS.ACTION' | translate }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let transaction of paginatedTransactions">
          <td>{{ transaction.user.name }}</td>
          <td>{{ getTypeKey(transaction.type) | translate }}</td>
          <td>{{ transaction.amount | number:'1.2-2' }}</td>
          <td>
            <span class="badge py-1 px-2 fs-13" [ngClass]="{
                'bg-success-subtle text-success': transaction.status === 'succeeded' || transaction.status === 'completed',
                'bg-warning-subtle text-warning': transaction.status === 'pending',
                'bg-danger-subtle text-danger': transaction.status === 'rejected' || transaction.status === 'failed',
                'bg-secondary-subtle text-secondary': !transaction.status
              }">
              {{ getStatusKey(transaction.status) | translate }}
            </span>
          </td>
          <td>{{ transaction.purchaseDate }}</td>
          <td>
            <div class="d-flex gap-2">
              <a href="javascript:void(0);" class="btn btn-light btn-sm"
                (click)="openTransactionModal(transactionModal, transaction)">
                <iconify-icon icon="solar:eye-broken" class="align-middle fs-18"></iconify-icon>
              </a>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="card-footer p-2 d-flex justify-content-between align-items-center">
    <div class="text-muted small">
      {{ 'TRANSACTIONS.SHOWING' | translate:{start: (page - 1) * pageSize + 1, end: Math.min(page * pageSize,
      collectionSize), total: collectionSize} }}
    </div>
    <ngb-pagination [(page)]="page" [pageSize]="pageSize" [collectionSize]="collectionSize" [maxSize]="5"
      [boundaryLinks]="true" [ellipses]="false" (pageChange)="refreshTransactions()" size="sm">
    </ngb-pagination>
  </div>
</div>

<ng-template #transactionModal let-modal>
  <div class="modal-header border-bottom-0 pb-0">
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>

  <div class="modal-body p-4" *ngIf="selectedTransaction">
    <div class="row g-3">
      <div class="col-md-6">
        <div class="card border-0 bg-light-subtle h-100">
          <div class="card-body p-3">
            <h6 class="card-title text-primary mb-3">
              <iconify-icon icon="solar:info-circle-bold-duotone" class="me-2"></iconify-icon>
              {{ 'TRANSACTIONS.MODAL_INFO_TITLE' | translate }}
            </h6>
            <div class="d-flex align-items-center mb-2">
              <iconify-icon icon="solar:user-bold-duotone" class="text-muted me-2"></iconify-icon>
              <span class="text-muted small">{{ 'TRANSACTIONS.CUSTOMER_NAME' | translate }}:</span>
              <span class="ms-2 fw-medium">{{ selectedTransaction.user.name || ('TRANSACTIONS.NA' | translate) }}</span>
            </div>
            <div class="d-flex align-items-center mb-2">
              <iconify-icon icon="solar:calendar-bold-duotone" class="text-muted me-2"></iconify-icon>
              <span class="text-muted small">{{ 'TRANSACTIONS.DATE' | translate }}:</span>
              <span class="ms-2 fw-medium">{{ selectedTransaction.purchaseDate || ('TRANSACTIONS.NA' | translate)
                }}</span>
            </div>
            <div class="d-flex align-items-center">
              <iconify-icon icon="solar:money-bag-bold-duotone" class="text-muted me-2"></iconify-icon>
              <span class="text-muted small">{{ 'TRANSACTIONS.AMOUNT' | translate }}:</span>
              <span class="ms-2 fw-medium">{{ selectedTransaction.amount }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card border-0 bg-success-subtle h-100">
          <div class="card-body p-3">
            <h6 class="card-title text-success mb-3">
              <iconify-icon icon="solar:users-group-rounded-bold-duotone" class="me-2"></iconify-icon>
              {{ 'TRANSACTIONS.MODAL_DETAILS_TITLE' | translate }}
            </h6>
            <div class="d-flex align-items-center mb-2">
              <iconify-icon icon="solar:tag-bold-duotone" class="text-muted me-2"></iconify-icon>
              <span class="text-muted small">{{ 'TRANSACTIONS.TYPE' | translate }}:</span>
              <span class="ms-2 fw-medium">{{ getTypeKey(selectedTransaction.type) | translate }}</span>
            </div>
            <div class="d-flex align-items-center mb-2">
              <iconify-icon icon="solar:check-circle-bold-duotone" class="text-muted me-2"></iconify-icon>
              <span class="text-muted small">{{ 'TRANSACTIONS.STATUS' | translate }}:</span>
              <span class="ms-2">
                <span class="badge bg-info-subtle text-info py-1 px-2 fs-12">
                  {{ getStatusKey(selectedTransaction.status) | translate }}
                </span>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-footer bg-light-subtle border-top-0 pt-3">
    <div class="d-flex gap-2 w-100 justify-content-end">
      <button type="button" class="btn btn-light border-2 px-4" (click)="modal.dismiss()">
        <iconify-icon icon="solar:close-circle-bold-duotone" class="align-middle me-1"></iconify-icon>
        {{ 'TRANSACTIONS.CLOSE' | translate }}
      </button>
    </div>
  </div>
</ng-template>