<div class="row justify-content-center">
  <div class="col-xl-5">
    <div class="card auth-card">
      <div class="card-body px-3 py-5">
        <app-logo-box className="mx-auto mb-4 text-center auth-logo" />

        <h2 class="fw-bold text-uppercase text-center fs-18">
          <span *ngIf="currentStep === 1">{{ 'RESET_PASSWORD.TITLE_STEP1' | translate }}</span>
          <span *ngIf="currentStep === 2">{{ 'RESET_PASSWORD.TITLE_STEP2' | translate }}</span>
        </h2>

        <p class="text-muted text-center mt-1 mb-4">
          <span *ngIf="currentStep === 1">
            {{ 'RESET_PASSWORD.DESC_STEP1' | translate }}
          </span>
          <span *ngIf="currentStep === 2">
            {{ 'RESET_PASSWORD.DESC_STEP2' | translate }} <b>{{ formData.email }}</b>
          </span>
        </p>

        <div *ngIf="message" class="alert" [ngClass]="isError ? 'alert-danger' : 'alert-success'" role="alert">
          {{ message }}
        </div>

        <div class="px-4">
          
          <form *ngIf="currentStep === 1" (ngSubmit)="handleEmailStep()">
            <div class="mb-3">
              <label class="form-label" for="email">{{ 'RESET_PASSWORD.EMAIL_LABEL' | translate }}</label>
              <input
                type="email"
                id="email"
                name="email"
                [(ngModel)]="formData.email"
                class="form-control bg-light bg-opacity-50 border-light py-2"
                [placeholder]="'RESET_PASSWORD.EMAIL_PLACEHOLDER' | translate"
                required
              />
            </div>
            <div class="mb-1 text-center d-grid">
              <button class="btn btn-primary py-2 fw-medium" type="submit" [disabled]="isLoading">
                {{ isLoading ? ('RESET_PASSWORD.SENDING' | translate) : ('RESET_PASSWORD.SEND_OTP' | translate) }}
              </button>
            </div>
          </form>

          <form *ngIf="currentStep === 2" (ngSubmit)="handleFinalStep()">
            
            <div class="mb-3 position-relative">
              <label class="form-label" for="otp">{{ 'RESET_PASSWORD.OTP_LABEL' | translate }}</label>
              <input
                type="number"
                id="otp"
                name="otp"
                [(ngModel)]="formData.OTP"
                class="form-control bg-light bg-opacity-50 border-light py-2"
                [placeholder]="'RESET_PASSWORD.OTP_PLACEHOLDER' | translate"
                required
              />
              
              <div class="text-end mt-1">
                <small *ngIf="resendTimer > 0" class="text-muted">
                  {{ 'RESET_PASSWORD.RESEND_IN' | translate }} <span class="text-timer">{{ resendTimer }}s</span>
                </small>
                <a href="javascript:void(0);" 
                   *ngIf="resendTimer === 0" 
                   (click)="resendOtp()" 
                   class="text-danger fw-bold small">
                   {{ 'RESET_PASSWORD.RESEND' | translate }}
                </a>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label" for="newpassword">{{ 'RESET_PASSWORD.NEW_PASSWORD_LABEL' | translate }}</label>
              <input
                type="password"
                id="newpassword"
                name="newpassword"
                [(ngModel)]="formData.newpassword"
                class="form-control bg-light bg-opacity-50 border-light py-2"
                [placeholder]="'RESET_PASSWORD.NEW_PASSWORD_PLACEHOLDER' | translate"
                required
              />
              
               <ul class="password-reqs list-unstyled mb-0">
                 <li [class.text-success]="formData.newpassword.length >= 8">
                   <i class="ri-checkbox-circle-line me-1"></i> {{ 'RESET_PASSWORD.REQ_8_CHARS' | translate }}
                 </li>
                 <li [class.text-success]="formData.newpassword.match('[A-Z]')">
                   <i class="ri-checkbox-circle-line me-1"></i> {{ 'RESET_PASSWORD.REQ_UPPER' | translate }}
                 </li>
                 <li [class.text-success]="formData.newpassword.match('[a-z]')">
                    <i class="ri-checkbox-circle-line me-1"></i> {{ 'RESET_PASSWORD.REQ_LOWER' | translate }}
                  </li>
                 <li [class.text-success]="formData.newpassword.match('[0-9]')">
                   <i class="ri-checkbox-circle-line me-1"></i> {{ 'RESET_PASSWORD.REQ_NUMBER_SPECIAL' | translate }}
                 </li>
               </ul>
            </div>

            <div class="mb-3">
              <label class="form-label" for="confirmpassword">{{ 'RESET_PASSWORD.CONFIRM_PASSWORD_LABEL' | translate }}</label>
              <input
                type="password"
                id="confirmpassword"
                name="confirmpassword"
                [(ngModel)]="formData.confirmPassword"
                class="form-control bg-light bg-opacity-50 border-light py-2"
                [placeholder]="'RESET_PASSWORD.CONFIRM_PASSWORD_PLACEHOLDER' | translate"
                required
              />
              <div *ngIf="formData.confirmPassword && formData.newpassword !== formData.confirmPassword" class="text-danger small mt-1">
                {{ 'RESET_PASSWORD.NOT_MATCHING' | translate }}
              </div>
            </div>

            <div class="mb-1 text-center d-grid gap-2">
              <button class="btn btn-primary py-2 fw-medium" type="submit" [disabled]="isLoading">
                {{ isLoading ? ('RESET_PASSWORD.PROCESSING' | translate) : ('RESET_PASSWORD.RESET_BTN' | translate) }}
              </button>
              
              <button type="button" class="btn btn-light py-2 fw-medium" (click)="currentStep = 1">
                {{ 'RESET_PASSWORD.CHANGE_EMAIL' | translate }}
              </button>
            </div>
          </form>

        </div>
      </div>
    </div>
    
    <p class="mb-0 text-center text-white">
      {{ 'RESET_PASSWORD.BACK_TO' | translate }}
      <a routerLink="/auth/sign-in" class="text-reset text-unline-dashed fw-bold ms-1">
        {{ 'RESET_PASSWORD.SIGN_IN_LINK' | translate }}
      </a>
    </p>
  </div>
</div>