<app-page-title title="{{ 'ANALYTICS.TITLE' | translate }}" subTitle="{{ 'ANALYTICS.SUBTITLE' | translate }}" />

<analytics-statistics [investmentsSummary]="investmentsSummary" [propertiesCount]="propertiesCount"
  [customersCount]="customersCount" />

<div class="row">
  <div class="col-xl-8">
    <analytics-sales-chart />
  </div>
  <div class="col-xl-4">
    <analytics-balance-card />

    <analytics-weekly-sales />

  </div>
</div>


<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <div>
      <h4 class="card-title">{{ 'ANALYTICS.PENDING_INVESTMENTS' | translate }}</h4>
    </div>
  </div>

  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table align-middle text-nowrap table-hover table-centered mb-0"
        *ngIf="pendingInvestments.length > 0; else noData">
        <thead class="bg-light-subtle">
          <tr>
            <th>{{ 'ANALYTICS.INVESTOR' | translate }}</th>
            <th>{{ 'ANALYTICS.EMAIL' | translate }}</th>
            <th>{{ 'ANALYTICS.PROPERTY' | translate }}</th>
            <th>{{ 'ANALYTICS.AMOUNT' | translate }}</th>
            <th>{{ 'ANALYTICS.SHARES' | translate }}</th>
            <th>{{ 'ANALYTICS.DATE' | translate }}</th>
            <th>{{ 'ANALYTICS.STATUS' | translate }}</th>
            <th style="width: 150px;">{{ 'ANALYTICS.ACTIONS' | translate }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let inv of pagedPendingInvestments">

            <td>{{ inv.investorName }}</td>
            <td>{{ inv.investorEmail }}</td>
            <td>{{ inv.propertyName }}</td>
            <td>{{ inv.amountInvested }} {{ 'CURRENCY.' + currency | translate }}</td>
            <td>{{ inv.sharesPurchased }}</td>
            <td>{{ inv.investmentDate | date:'mediumDate' }}</td>
            <td>
              <span class="badge py-1 px-2 fs-12" [ngClass]="{
    'bg-warning-subtle text-warning': inv.status.toLowerCase() === 'pending',
    'bg-success-subtle text-success': inv.status.toLowerCase() === 'approved',
    'bg-danger-subtle text-danger': inv.status.toLowerCase() === 'rejected'
  }">
                {{ ('ANALYTICS.STATUS_' + (inv.status | titlecase)) | translate }}
              </span>

            </td>
            <td>
              <div class="d-flex gap-2">
                <button class="btn btn-success btn-sm" (click)="approve(inv)">
                  {{ 'ANALYTICS.APPROVE' | translate }}
                </button>
                <button class="btn btn-danger btn-sm" (click)="reject(inv)">
                  {{ 'ANALYTICS.REJECT' | translate }}
                </button>
              </div>
            </td>

          </tr>
        </tbody>
      </table>

      <ng-template #noData>
        <div class="text-center p-3 text-muted">{{ 'ANALYTICS.NO_PENDING' | translate }}</div>
      </ng-template>
    </div>
    <div class="card-footer">
      <nav [attr.aria-label]="'COMMON.PAGE_NAVIGATION' | translate">
        <ngb-pagination [collectionSize]="pendingInvestments.length" [(page)]="page" [pageSize]="pageSize" [maxSize]="5"
          [rotate]="true" [boundaryLinks]="true" class="pagination justify-content-end mb-0">
          <ng-template ngbPaginationPrevious>
            {{ 'COMMON.PREVIOUS' | translate }}
          </ng-template>
          <ng-template ngbPaginationNext>
            {{ 'COMMON.NEXT' | translate }}
          </ng-template>
        </ngb-pagination>
      </nav>
    </div>


  </div>
</div>

<ng-template #loadingTpl>
  <p class="loading">loading</p>
</ng-template>


<style>
  .dashboard {
    padding: 20px;

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 30px;

      .card {
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        text-align: center;

        h3 {
          font-size: 16px;
          margin-bottom: 10px;
          color: #444;
        }

        p {
          font-size: 22px;
          font-weight: bold;
          color: #2c7be5;
        }
      }
    }

    .section {
      margin-bottom: 40px;

      h2 {
        margin-bottom: 15px;
        font-size: 18px;
        color: #333;
      }

      table {
        width: 100%;
        border-collapse: collapse;

        th,
        td {
          border: 1px solid #ddd;
          padding: 10px;
          text-align: center;
        }

        th {
          background: #f5f5f5;
          font-weight: bold;
        }

        tr:nth-child(even) {
          background: #fafafa;
        }
      }
    }

    .loading {
      text-align: center;
      font-size: 18px;
      color: #666;
    }
  }
</style>